Coursera BlockChain Basics
==========================

https://www.coursera.org/learn/blockchain-basics/lecture/Nyuq7/blockchain-defined-bitcoin-blockchain

Week 1 - 10/7/2018
======================

* 3 fundamental characteristics w/c define BC
* Important features of Ethereum BC
* Algos and techniques to enable BC
* Methods for realizing trust

BitCoin:
* Solves double-spending problem by checking all previous transactions
* Autonomous decentralized app
* Peer to peer, no central authority, eliminate intermediaries
* Longest proof-of-work chain is accepted as the truth
* Proof of work is largest pool of CPU power
* Validation
* Verification
* Concensus
* Immutable recording


### Basic Structure:

* Transactions
* Many transactions = block
* Many blocks = Chain

UTXO - Unspent Transaction Output - Set of all UTXOs in bitcoin network define the state of the BC blockchain.

Can be inputs and outputs of a transaction.

Transaction:
- Reference number
  - List of Input UTXOs

List of Ouput UTXOs (newly generated by trans)\
- Total input and output amt

UTXO:
- Unique id\
- Index in the trans output list\
- value\
- script (optional)

Block:
- Header
- Set of valid Transactions
- Block Hashes - Current, prev, next
- Nonce


### Participants

1. Those who initiate transfer of value
2. Miners, who do additional work:
   - Verify transactions
   - Broadcast transactions
   - Compete to create new blocks
   - Reach consensus by validating blocks
   - Broadcast new block
   - Confirm transactions

Miners are incentivised with bitcoins for doing the work.


### Basic Operations:

From Quiz:

	What is the correct sequence involved in a block creation:

	3. Transaction initiated
	1. Transactions validated
	2. Transactions Bundled & broadcasted
	5. Proof of work consensus problem solved
	4. Block added to the local chain and propagated to the network.


Transaction validation is carried out independently by all miners.

Transaction validation involves checking 20 criteria.

Reject invalid trans.  Collect valid trans into a pool and select a set of trans to add to a block.

Must solve a puzzle to generate a new block and broadcast.  CPU intensive computational puzzle.  Proof-of-work protocol.

Transaction 0 in each block is called "Coinbase" txn, does not have any input UTXOs, and is for paying the miner fees.

Wallets - Receive payments

Addresses - Send payments to addresses

Wallets keep track of transactions, not balances

Payment uses up a transaction, creates a payment transaction, and a "change" transaction for the remaining amount (if any)


### Blockchain categories

3 types:
- Cryptocurrency only - Bitcoin
- Ccy and business logic (Smart contract scripts) - Etherium
- Only bus logic - Hyperleger

Categories:
- Public - Bitcoin
  - Untrusted
  - Requires defense - `Proof of work`, computationally difficult
  - Costs, requires incentives - Block reward

- Private
  - Limited to selected participants, in a single organization
  - Trusted, can make it easier to add blocks, cheaper
  - Can use transaction fees instead of block rewards.
  - More control - Can revert transactions, modify balances, etc.
  - More privacy

- Permissioned
  - Consortium, multiple organizations

Can have hybrid combinations:
- Private administered smart contracts on public blockchains
- Cross-chain exchange layers between public and private blockchains

### Week 1 Evaluation

Blockchain explorer and Etherscan
- https://www.blockchain.com/explorer
- https://blockexplorer.com/
- https://etherscan.io/

Task 1: Understanding the Genesis Block (Q2-Q3)
- Explore the **Genesis block** (Block 0)

Task 2: Exploring a block in the Bitcoin Blockchain (Q4-Q5)
- Explore block #490624


Week 2 - 10/8/2018
==============================

### Smart Contracts

Bitcoin vs Ethereum:
- Bitcoin has wallet vs smart contracts which can do more than just transfer value.

Smartcontract is a piece of code.  Triggered by a message embedded in a tranaction.

More sophisticated than just add/subtract value.  Conditional logic, waiting for a condition.

Criteria to accept or reject a transaction.

Specific programming languages created for smart contracts.

**Solidity**

Need computational infrastructure.  Each ethereum node must be able to run the code.

Etherium Virtual Machine (EVM)

Contract is collection of code and data (state) that is stored at a specific address on the Ethereum blockchain.

**Accounts**
- External - EOA (Externally owned accounts)  Humans.  Controlled by **private** keys.
- Contract accounts - Controlled by code.

Each account has key/value storage, and a balance.

**Gas**
- Fee to execute a transaction, to limit the amount of work needed to execute it.
- Gas price is set by creator of the contract, paid up-front.  Any leftover is refunded to the creator.
- if you run out of gas, an exception is triggered and the changes are all reverted back.

**Storage, Memory, Stack**
- Each account has Storage (key/values)
- Memory - Each contract gets fresh cleared memory for each message call.  Read 256 bits.  Write 8 bits or 256 bits.  Must pay gas when expanding memory.  Gets more expensive quadratically.


### Ethereum Structure

Bitcoin defined state using UTXO

Ethereum added accounts, which are the originators and target of transactions.

EOA - Externally owned accounts

CA - Contact accounts - Controlled by code, activated only be an EOA.

Every account has a coin balance.

Account address is the last 20 bytes of the public key.

1 ether = 10\*\*18 Wei

Eth Transaction Detail:
- Hash
- height
- From to accounts
- value transferred
- Gas limit
- Gas used
- Nonce

Eth Block Details:
- Height
- Hash
- Difficulty
- Size
- Gas used
- Gas limit
- Nonce
- Block reward


### Etherum Operations

(10/25/2018)

**Ether transfer** - Amount to transfer, target account, gas points (fees).

Gas points are paid to the miner who adds the transaction block to the chain.

**Ethereum Full Node** has:

- Transaction initiation
- validation
- mining
- block creation
- smart contract execution
- Ethereum Virtual Machine (EVM)

**Smart contracts**

Can be the target address of a transaction.  Activated and executed on the EVM.

Inputs come from the `payload` field of the transaction.

`state` of the SC is the value of all the variables defined.

Result of the SC is stored in the `receipts`.

Blockchain maintains both a state hash and receipt hash.

**Transaction validity**

- Check timestamp and nonce
- availablity of sufficient fees for execution

**Additional Reading**

Ethereum vs BitCoin:

	ethereum borrows heavily from bitcoin's protocol and its blockchain design, but tweaks it to support applications beyond money.

	Ethereum aims to abstract away bitcoin's design, however, so that developers can create applications or agreements that have additional steps, new rules of ownership, alternative transaction formats or different ways to transfer state.

	The structure of the ethereum blockchain is very similar to bitcoin's, in that it is a shared record of the entire transaction history. Every node on the network stores a copy of this history.

	The big difference with ethereum is that its nodes store the most recent state of each smart contract, in addition to all of the ether transactions. (This is much more complicated than described, but the text below should help you get your feet wet.)

UTXO vs Accounts:

	Bitcoin uses unspent transaction outputs to track who has how much bitcoin.

	While it sounds more complex, the idea is fairly simple. Every time a bitcoin transaction is made, the network 'breaks' the total amount as if it was paper money, issuing back bitcoins in a way that makes the data behave similarly to physical coins or change.

	To make future transactions, the bitcoin network must add up all your pieces of change, which are classed as either 'spent' or 'unspent'.

	Ethereum, on the other hand, uses accounts.

Gas:

- Gas is the way that fees are calculated
- The fees are still paid in ether, though, which is different from gas
- The gas cost is the amount of work that goes into something, like the number of hours of labour, whereas the gas price is like the hourly wage you pay for the work to be done. The combination of the two determines your total transaction fee.
- If your gas price is too low, no one will process your transaction
- If your gas price is fine but the gas cost of your transaction runs "over budget" the transaction fails but still goes into the blockchain, and you don't get the money back for the work that the labourers did.
- This makes sure that nothing runs forever, and that people will be careful about the code that they run. It keeps both miners and users safe from bad code!

### Incentive Model

**Gas Points**

Stanadrdized fixed price of operations.  Value does not vary like Ether.

Ex. of operations:

- Step = 1 gas pt
- Load from mem = 20 
- Store into mem = 100
- Transaction base fee = 21000
- Contract creation = 53000
- etc

Gas items in a block:

- Gas Limit - Max amount that will be paid
- Gas Spent - Actual amount of gas spent in the transaction.

**Mining Incentive Model**

Miner who solves the POW puzzle and creates an new block gets:
- Base fee of 3 ether and transaction fees.

Also gets fees and gas points for execution of a smart contract transaction.

`Ommers` - Solved the puzzle but did not win.  Also get a small part of the total gas points.

Blocks created by ommers are called Ommer blocks.  Added as Side blocks.  

**Additional Reading**

	3 ethers are created every block (roughly 15 seconds) to the miner of the block

	0.625-2.625 ethers are sometimes sent to another miner if they were also able to find a solution but his block wasn't included (called uncle/aunt reward)

Converting from POW to POS in 2018-2019.  Called Casper.  Based on GHOST protocol. (Greedy Heaviest-Observed Sub-Tree)

Casper is a security-deposit based economic consensus protocol.

**Ethereum Wallet Mist:**

https://www.ethereum.org/ether

Downloaded from Github.  Got errors initially. (Hanging on generating account)  Need to switch to test network (Ropsten) first, and restart before creating an account.  May need to restart a couple times.

Created account Test.  Directed to save the keystore file from `C:\Users\Brian\AppData\Roaming\Ethereum`.  Saved in `C:\Users\Brian\Documents\_Tech Info & Serial Numbers\PublicPrivateKeys\Ethereum Mist Wallet Keystores`

**Quiz:**

Failed.

1. Correct - 0xc253f0917b33b2947b4d9cdb7ad656cc0233ef1781984384284f3a91810a8a36
2. Wrong - Total difficulty for the block.  I selected Difficulty which is just for the block, but I guess they want Total difficulty, which is really for the entire chain till that block.
3. Correct - 913.268
4. Correct - 0xf9fba58d8345bd3100c5adf3b8b51938e5da0a9d
5. Correct - EOAs can send transactions (ether transfer or invoke a contract code)
6. Wrong - External Owned Accounts (EOA) are controlled by ____.
- Hash of the first transaction by that account
- XXX - Public Key and Private Key
- Correct ---> Private Key
- Public Key
7. Correct - Smart Contracts
8. Correct - 22 gas
9. Correct - 3,1,2,5,4


Week 3 - 10/25/2018 - 11/2/2018
==============================

### Public-Key Cryptography

Hashing VS Asymmetric key encryption

**Simple Symmetric key**

Same key used for encrypting and decrypting.

Easy to guess the key.

How to distribute the key to the other party?

How to deal with multiple unknown parties like blockchain?

**Public Key Encyption (Asymmetric)**

Public key and Private Key pair.  (Public key is derived from the private key.)

Encrypt with private key, decrypt with public key, or encrypt with public key, and decrypt with private key.

To send secure message, sign with your private key, then sign with the recipient's public key.  Recipient will decrypt with their private key, so no one else can decrypt.  Then they will decrypt with your public key, so they know you were the sender.

Allows Digital Signatures to confirm a signer, and provide non-repudiation.

* RSA - Common pub-priv implementation.  Password=less authentication (ssh).  Involves factoring numbers which are the product of two large primes. But Blockchain needs more efficent

* ECC - Elliptic curve crypto - Stronger than RSA for same num of bits. (256 bits ECC = 3072 bits RSA.) Used by both Bitcoin and Ethereum.  Involves computing elliptic curve discrete logarithm (which is much harder than factoring).

### Hashing

What is hashing: Converts input of any length into a _unique_ fixed length value.  (= Number of bits)

Hash algo should be One Way function (can't determine the original input), and Collision Free (unique).

Use strong hash algo and large bit size.  256 bits.

* SHA-3
* SHA-256
* Keccak

256 bits = 2^256 possible combinations = 10^77 (10 with 77 zeros)

**Simple hashing**

Used when _fixed_ number of items (block header) or verifying composite block integrity.


**Merkle tree hashing**

Merkle tree is a simple binary tree with a root node, node hashes, leaf hashes, and leaves.

In a Merkle tree, each non-leaf node is the hash of the values of their child nodes.

Leaves have data.  Each leaf data has a leaf hash.  Pairs of leaves are hashed together into a node hash.  Pairs of nodes are hashed into other nodes, up to the root.

You can add new data without having to rehash the entire tree.  Just create a new tree with the new data, and create a new root which connects the old tree and the new tree.

You can also validate a single transaction using **only one path through the tree**, instead of looking at all transactions.

Used when there are different number of items:
* Account addresses
* Digital signatures
* Transaction hash
* State hash
* Receipt hash
* Block header hash


## Transaction Integrity

We need:
* Secure and unique account address
* digital signature of sender for authorization
* Verification that content of transaction has not been modified.

**Addresses**

1. 256 bit random number = private key
2. Generate public key using ECC
3. Public key is hashed to get the account address (20 bytes = 160 bits)

** Transaction**

Must be:
* Authorized
* Non-repudiable
* Unmodifiable

Data is hashed, and encrypted.  This is the digital signature.

Receiver gets original data and the signature.  To verify integrity, they can recompute the hash and compare to the signature.

For complete trans verification, also need to verify:
* timestamp
* Nonce
* Account balances
* sufficiency of fees

## Securing Blockchain

Etherium block contains:

* Block Header
* Transaction Hash or Root
* State Hash or Root

Integrity of each must be ensured.

Ethereum block Hash is the hash of **all** the elements in the block header, including transaction root and state root hashes.

Ethereum block hash is computed using Keccak (variant of SHA-3)

Eth blocks contain 100s of transactions.  Transaction hash is computed using Merkle Tree Hash, to be efficient.

Merkle tree hash also used for the state root hash, which has chained states from block to block.

Also used for Receipt root hash.

Smart contract executions in Eth results in State transitions.  Every state change requires state root (hash) recomputation.  Instead of recomputing hash for all the states, only the affected path needs to be recomputed.

When a state changes, you only need to recompute it's hash, and the upper nodes, up to the root, which is much fewer than all the leaves.

**Block Hash**

Includes State, transaction and receipt root hashes, plus all the other data in the block header (including the **Previous block hash**), and the **Nonce**, and used to solve the Proof of Work puzzle.

The block hash verifies the integrity of the block and the transactions.

It also forms the chain link by embedding the previous block hash in the current block header.

If any participant node (miner) tampers with the block, it's hash value will change, resulting in the mismatch of the hash values, which causes the local chain to be in an **invalid state**.  Other nodes will reject any future blocks from this miner.


**Quiz:**

1. Wrong - None\
    Should be Transactions
2. Hash of block #490624: 000000000000000000d4c8b9d5388e42bf084e29546357c63cba8324ed4ec8bf\
    (Be careful of leading spaces on the merkle root hash)\
    Version: 0x20000000\
    Merkle Root Hash: 73effaecabddef72c9b6b738efb131c543370766b93d4cc15db995a9afb1a286\
    Bits: 402713392\
    Prev block hash: 0000000000000000004239f2a01d8f579bc0dbb214d0f874ece5db587bee3457\
    Timestamp: Oct 19, 2017 10:35:32 AM\
    Nonce: 3060038614
3. Private key
4. SHA-256
5. ECC
6. Original message cannot be retrieved
7. 1,2,4
8. Supports both user auth and integrity
9. Security
10. Private key


Week 4 - 11/2/2018-
==============================

### Decentralized Systems

